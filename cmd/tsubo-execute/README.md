# tsubo-execute

Tsubo Execution Engine - Generates implementation prompts for AI agents based on implementation plans.

## Overview

`tsubo-execute` is Phase 1 of the execution engine that:
1. Loads an implementation plan (generated by `tsubo-plan`)
2. Generates comprehensive prompts for AI agents
3. Outputs prompts to files for manual or automated execution

## Installation

### Build from source

```bash
# From the project root
go build -o tsubo-execute ./cmd/tsubo-execute

# Or install to $GOPATH/bin
go install ./cmd/tsubo-execute
```

## Usage

```bash
tsubo-execute <plan.json>
```

Example:
```bash
# Step 1: Generate implementation plan
./tsubo-plan ./poc/contracts/tsubo-todo-app.tsubo.yaml

# Step 2: Generate implementation prompts
./tsubo-execute /tmp/tsubo-implementation-plan.json
```

## What it does

### Step 1: Load implementation plan
Reads the JSON plan file generated by `tsubo-plan`.

### Step 2: Generate implementation prompts
For each object in the plan, generates a comprehensive prompt that includes:

1. **Context files** (embedded in prompt):
   - `PHILOSOPHY.md` - Tsubo's core philosophy
   - `DEVELOPMENT_PRINCIPLES.md` - Docker First, questioning timing
   - `WHY_GO.md` - Why Go language minimizes hallucination
   - `CONTRACT_DESIGN.md` - How to read contracts

2. **Contract** (embedded in prompt):
   - The complete `.object.yaml` contract for the service

3. **Implementation instructions**:
   - Output directory
   - Required files (main.go, Dockerfile, etc.)
   - Principles to follow
   - Dependencies to handle

### Output

Prompts are saved to `/tmp/tsubo-prompt-<service-name>.md`

Example output:
```
/tmp/tsubo-prompt-user-service.md    (55KB, ~1,735 lines)
/tmp/tsubo-prompt-todo-service.md    (65KB, ~2,017 lines)
```

Each prompt is self-contained and includes everything an AI agent needs to implement the service.

## Prompt Structure

```markdown
# Implementation Task: <service-name>

## Step 1: Read and understand context files
- PHILOSOPHY.md (full content)
- DEVELOPMENT_PRINCIPLES.md (full content)
- WHY_GO.md (full content)
- CONTRACT_DESIGN.md (full content)

## Step 2: Read the contract
- <service-name>.object.yaml (full content)

## Step 3: Understand dependencies
- List of dependent services
- Communication guidelines

## Step 4: Implement the service
- Implementation directory
- Required files
- Important principles
- Output location
```

## Next Steps

After generating prompts:

1. **Review prompts**:
   ```bash
   cat /tmp/tsubo-prompt-user-service.md
   ```

2. **Execute with AI agents**:
   - **Manual**: Copy prompt content and paste into Claude Code or other AI tool
   - **Automated** (Phase 2): Use Claude API to execute automatically

3. **Follow wave order**:
   - Wave 0: Implement all objects in parallel
   - Wave 1: Wait for Wave 0 completion, then implement
   - Continue for additional waves

## Example Workflow

```bash
# 1. Generate implementation plan
./tsubo-plan ./poc/contracts/tsubo-todo-app.tsubo.yaml

# 2. Generate prompts
./tsubo-execute /tmp/tsubo-implementation-plan.json

# 3. Review prompts
ls -lh /tmp/tsubo-prompt-*.md

# 4. Implement Wave 0 (parallel)
# - Use AI agent with /tmp/tsubo-prompt-user-service.md

# 5. Implement Wave 1 (after Wave 0 completes)
# - Use AI agent with /tmp/tsubo-prompt-todo-service.md

# 6. Test implementations
cd poc/implementations/user-service
./test-contract.sh

cd ../todo-service
./test.sh
```

## Future Enhancements (Phase 2)

- **Automated execution**: Direct Claude API integration
- **Parallel execution**: Launch multiple AI agents simultaneously
- **Progress tracking**: Monitor implementation status
- **Validation**: Verify contract compliance automatically
- **Retry logic**: Handle failures and retries

## Architecture

```
tsubo-execute
├── Load Plan (JSON)
├── For each Wave:
│   ├── For each Object:
│   │   ├── Read context files
│   │   ├── Read contract
│   │   ├── Generate prompt
│   │   └── Save to file
│   └── Wait for wave completion (manual in Phase 1)
└── Output prompts
```

## Philosophy

This tool embodies the Tsubo principle:
- **Human defines "what"**: Contracts specify requirements
- **AI implements "how"**: Generated prompts guide AI agents
- **Automation where it matters**: Prompt generation is automated
- **Human in the loop**: Execution is manual (for now)

Phase 1 focuses on getting the prompts right. Phase 2 will automate execution.

## License

MIT
