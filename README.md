# Tsubo（坪）

> AI駆動開発のためのマイクロサービスフレームワーク

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Status](https://img.shields.io/badge/status-design%20phase-yellow.svg)]()

## 概要

**Tsubo（壺）** は、AI（LLM）による並列実装を加速させ、ハルシネーションを削減するために設計された、マイクロサービス開発フレームワークです。

### 壺のメタファー

```
   ┌─────────────────────────────────────┐
   │  壺（Tsubo）= アプリケーション全体   │  ← 人間が決める
   │                                     │
   │  ┌──────────┐  ┌──────────┐        │
   │  │  TODO    │  │   User   │  ...   │  ← 固体オブジェクト
   │  │ Contract │  │ Contract │        │     (ドメイン)
   │  │  ┌────┐  │  │  ┌────┐  │        │
   │  │  │実装│  │  │  │実装│  │        │  ← AIが決める
   │  │  └────┘  │  │  └────┘  │        │
   │  └──────────┘  └──────────┘        │
   │       ↓              ↓              │
   │  todo-service   user-service       │  ← マイクロサービス
   └─────────────────────────────────────┘
```

**人は壺の形（アプリケーション）と中に入れる固体オブジェクト（ドメイン）を決める。AIは各オブジェクトの内部構造を作る。**

- **壺**: アプリケーション全体（容器）
- **固体オブジェクト（ドメイン）**: 具体的なビジネス概念（触れるもの）
- **マイクロサービス**: 各固体オブジェクトの実装
- **実装の詳細**: オブジェクトの内部構造（AIが決める）

### なぜ Tsubo なのか？

現代のAI駆動開発では、以下の課題があります：
- 大規模なコードベースでは、AIがコンテキストを失いやすい
- モノリシックな実装では、並列開発が困難
- 明確な境界がないと、AIが整合性のないコードを生成する

Tsubo は、これらの課題を「**壺＝コンテキストの境界**」という発想で解決します。

**Tsubo の哲学:**
- 人間は「**何をすべきか**」（Contract定義、ドメインの境界）に集中
- AIは「**どう実装するか**」（実装の詳細）に集中
- **1つの壺（アプリケーション）に複数の固体オブジェクト（ドメイン/マイクロサービス）を入れる**
- 各固体オブジェクトは独立し、疎結合を実現

## 核心的なアイデア

```
小さなサービス → AIが理解しやすい → ハルシネーション削減
     ↓
明確な契約 → 並列実装可能 → 開発速度向上
     ↓
自動検証 → 品質保証 → 信頼性の高いコード
```

## 主要機能

### 🎯 サービス定義の標準化
宣言的なYAMLフォーマットで、マイクロサービスの仕様を定義。AIが理解しやすい形式。

### 🔄 並列実装オーケストレーション
複数のAIエージェントが、依存関係を考慮しながら並列にサービスを実装。

### ✅ 自動検証・テスト
契約テスト、型チェック、統合テストを自動的に実行し、品質を保証。

### 🚀 高速な開発サイクル
従来の3-5倍の速度でマイクロサービスを実装。

## クイックスタート

### PoC の実行（Tsubo TODO アプリケーション）

```bash
# リポジトリをクローン
git clone https://github.com/your-org/tsubo.git
cd tsubo/poc/tsubo-todo-app

# 壺（アプリケーション全体）を起動
docker-compose up -d

# 統合テストの実行
./test-integration.sh

# 停止
docker-compose down
```

**含まれるドメイン（固体オブジェクト）:**
- User ドメイン（user-service: port 8084）
- TODO ドメイン（todo-service: port 8083）

### 将来の CLI（開発予定）

```bash
# Tsubo のインストール
go install github.com/your-org/tsubo-cli

# 新しいサービスを定義
tsubo new user-service

# AI駆動で実装を生成
tsubo build user-service --ai

# 全サービスを並列ビルド
tsubo build --all --parallel

# 検証
tsubo verify

# 実行
tsubo run
```

## アーキテクチャ

```
┌─────────────────────────────────────────┐
│         Service Definitions             │
│     (user-service.tsubo.yaml)           │
└────────────┬────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│         Orchestrator (Go)               │
│  - 依存関係解析                          │
│  - AI エージェント管理                    │
│  - 並列実行制御                          │
└────────────┬────────────────────────────┘
             │
             ▼
┌──────────┬──────────┬──────────┬────────┐
│ AI Agent │ AI Agent │ AI Agent │  ...   │
│ Service1 │ Service2 │ Service3 │        │
└────┬─────┴────┬─────┴────┬─────┴────┬───┘
     │          │          │          │
     ▼          ▼          ▼          ▼
┌────────────────────────────────────────┐
│         Validator (Rust)               │
│  - 契約テスト                            │
│  - 型チェック                            │
│  - 統合テスト                            │
└────────────────────────────────────────┘
```

## 技術スタック

- **全コンポーネント:** Go（統一されたコードベース）
  - Orchestrator: 並行処理、シンプルさ
  - Validator: 型安全性、十分なパフォーマンス
  - CLI: シングルバイナリ配布
- **Contract Definition:** YAML（人間・AI両方が読みやすい）
- **生成サービス:** Go（推奨）
  - 将来的に TypeScript, Python もサポート

### なぜ Go言語なのか？

**Go の「誰が書いても同じコードになる」という特性が、AIによるハルシネーションを劇的に低減します。**

詳細は [WHY_GO.md](./docs/WHY_GO.md) を参照。

## プロジェクト状況

現在、PoC フェーズです。以下を進めています：

- [x] 基本思想の整理
- [x] サービス定義フォーマットの仕様策定（Contract Design）
- [x] **開発原則の確立**（Docker First & 質疑のタイミング）
- [x] **PoC 実装完了**（TODO アプリケーション - 壺の実装）
  - [x] 壺（アプリケーション全体）の設計
  - [x] User ドメイン（固体オブジェクト1）
    - [x] Contract 定義
    - [x] Go 実装
    - [x] Docker 化
  - [x] TODO ドメイン（固体オブジェクト2）
    - [x] Contract 定義
    - [x] Go 実装
    - [x] Docker 化
    - [x] User ドメインとの連携
  - [x] docker-compose による全体のオーケストレーション
  - [x] 統合テスト（ドメイン間連携の確認）
- [ ] オーケストレーターの自動化
- [ ] 検証エンジンの実装
- [ ] AI駆動での自動実装

## ドキュメント

### 核心思想
- [設計思想（PHILOSOPHY.md）](./PHILOSOPHY.md) - Tsubo の核心的な考え方
- [ドメイン設計（DOMAIN_DESIGN.md）](./docs/DOMAIN_DESIGN.md) - 1つの壺 = 1つのドメイン = 1つのマイクロサービス

### 開発ガイド
- [開発原則（DEVELOPMENT_PRINCIPLES.md）](./docs/DEVELOPMENT_PRINCIPLES.md) - Docker First & 質疑のタイミング
- [Contract 設計（CONTRACT_DESIGN.md）](./docs/CONTRACT_DESIGN.md) - Contract フォーマットの詳細
- [なぜ Go 言語か（WHY_GO.md）](./docs/WHY_GO.md) - Go 言語選択の理由

### 今後作成予定
- アーキテクチャ設計
- APIリファレンス
- チュートリアル

## コントリビューション

現在は設計フェーズのため、アイデアやフィードバックを歓迎します。

## ライセンス

MIT License（予定）

## 名前の由来

**壺（Tsubo）** には、深い意味が込められています：

> **壺は、アプリケーション全体を表す容器である。**
>
> **ドメインは、壺の中に入れる固体オブジェクトである。**
>
> 1つの壺の中には、複数の固体オブジェクト（ドメイン）が入る。
> 各固体オブジェクトは独立したマイクロサービスとなる。
>
> 人は**どの固体オブジェクト（ドメイン）を壺に入れるか**を決め、
> 各オブジェクトの**インターフェース（Contract）**を定義する。
> オブジェクトの内部構造がどう作用するかは**AIが決める**。
>
> **1つの壺（アプリケーション）= 複数の固体オブジェクト（ドメイン/マイクロサービス）の集合**

**カプセル化の新しい意味:**
- 伝統的なカプセル化: 内部実装を外部から隠蔽
- Tsubo のカプセル化: **人間から実装の詳細を隠蔽**、AIに任せる
- **固体オブジェクトの独立性**: 各ドメイン（マイクロサービス）は壺の中で独立して存在

壺の中の固体オブジェクト（ドメイン）の集合が、堅牢なアプリケーションを作ります。

## 開発原則

Tsubo は以下の原則に基づいて開発されます：

### 🐳 Docker First
- すべての実装は仮想環境（Docker）で実行
- ローカル環境への影響ゼロ
- 再現性の保証

### 🤐 質疑のタイミング
- **実装前（Contract段階）**: 曖昧性の排除、セキュリティ確認
- **実装中**: 質疑なし、AIが自律的に実装

### 📝 Contract is Everything
- Contract は唯一の真実（Single Source of Truth）
- 人間は「何をすべきか」を定義
- AI は「どう実装するか」を決定

詳細は [DEVELOPMENT_PRINCIPLES.md](./docs/DEVELOPMENT_PRINCIPLES.md) を参照。

---

**Status:** 🚀 PoC Phase
**Version:** 0.2.0 (PoC)
**Latest PoC:** Tsubo TODO App（壺の実装完了）
  - 壺（アプリケーション全体）
  - 2つの固体オブジェクト（User & TODO ドメイン）
  - ドメイン間連携
  - Docker Compose によるオーケストレーション
